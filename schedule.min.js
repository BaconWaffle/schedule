schedule=function(){function e(e){return e.id}function r(e){return e.schedule}function n(e){return e.isNotReservable||!1}function t(e){return e.id}function a(e){return e.id}function s(e){return e.schedule}function u(e){return e.resources}function i(e){return e.dependsOn}function o(e){return e.splittable}var c={version:"0.6.0"},d=!d&&require?require("later"):d;return Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),c.date={},c.date.UTC=function(){d.date.UTC()},c.date.localTime=function(){d.date.localTime()},c.functor=function(e){return"function"==typeof e?e:function(){return e}},c.memoizedRangeFn=function(e){var r={};return function(n){if(!r[n]){var t=e(1,n);r[n]=[t[0].getTime(),t[1]?t[1].getTime():41024448e5]}return r[n]}},c.sort={},c.sort.tasks=function(e,r){r.sort(function(r,n){var t=e.tasks[r],a=e.tasks[n];return a.priority&&(!t.priority||a.priority>t.priority)?-1:t.priority&&(!a.priority||t.priority>a.priority)?1:e.tasks[n].floatAmt>e.tasks[r].floatAmt})},c.resources=function(t){function a(){for(var e={},r=c.functor(s),n=c.functor(u),a=c.functor(i),o=0,d=t.length;d>o;o++){var l=t[o],f=r.call(this,l,o),h=n.call(this,l,o),v=a.call(this,l,o);e[f]={id:f,schedule:h,isNotReservable:v}}return e}var s=e,u=r,i=n;return a.id=function(e){return arguments.length?(s=e,a):s},a.schedule=function(e){return arguments.length?(u=e,a):u},a.isNotReservable=function(e){return arguments.length?(i=e,a):i},a},c.tasks=function(e){function r(){for(var r=[],t=c.functor(n),a=c.functor(d),s=c.functor(l),u=c.functor(f),i=c.functor(h),o=c.functor(v),g=0,p=e.length;p>g;g++){var y=e[g],m={id:t.call(this,y,g),duration:a.call(this,y,g),schedule:s.call(this,y,g),resources:u.call(this,y,g),dependsOn:i.call(this,y,g),splittable:o.call(this,y,g)};r.push(m)}return map}var n=t,d=a,l=s,f=u,h=i,v=o;return r.id=function(e){return arguments.length?(n=e,r):n},r.duration=function(e){return arguments.length?(d=e,r):d},r.schedule=function(e){return arguments.length?(l=e,r):l},r.resources=function(e){return arguments.length?(f=e,r):f},r.dependsOn=function(e){return arguments.length?(h=e,r):h},r.splittable=function(e){return arguments.length?(v=e,r):v},r},c.dependencyGraph=function(e){function r(e){for(var r={tasks:{},roots:[],leaves:[],resources:[],depth:0,end:0},c=0,d=e.length;d>c;c++)r.tasks[e[c].id]=e[c];return n(r),a(r.tasks),s(r),u(r,r.leaves,0),r.depth+=1,i(r,{},r.roots,0),t(r,r.leaves),o(r,{},r.leaves,r.end),r}function n(e){for(var r in e.tasks){var n=e.tasks[r];if(n.resources)for(var t=0,a=n.resources.length;a>t;t++){var s=n.resources[t];-1===e.resources.indexOf(s)&&e.resources.push(s)}}}function t(e,r){for(var n=0,t=r.length;t>n;n++){var a=e.tasks[r[n]].earlyFinish;e.end=a>e.end?a:e.end}}function a(e){for(var r in e){var n=e[r],t=n.dependsOn;if(t)for(var a=0,s=t.length;s>a;a++){var u=e[t[a]];(u.requiredBy||(u.requiredBy=[])).push(n.id)}}}function s(e){for(var r in e.tasks){var n=e.tasks[r];n.dependsOn&&0!==n.dependsOn.length||e.roots.push(n.id),n.requiredBy&&0!==n.requiredBy.length||e.leaves.push(n.id)}}function u(e,r,n){for(var t=0,a=r.length;a>t;t++){var s=e.tasks[r[t]],i=s.dependsOn;s.depth=!s.depth||n>s.depth?n:s.depth,e.depth=n>e.depth?n:e.depth,i&&u(e,i,s.depth+1)}}function i(e,r,n,t){c(r,n,t);for(var a=0,s=n.length;s>a;a++){var u=n[a],o=e.tasks[u],d=o.dependsOn,l=r[u];o.earlyFinish||d&&(!l||l[0]!==d.length)||(o.earlyStart=l[1],o.earlyFinish=l[1]+o.duration,o.requiredBy&&i(e,r,o.requiredBy,o.earlyFinish))}}function o(e,r,n,t){c(r,n,t,!0);for(var a=0,s=n.length;s>a;a++){var u=n[a],i=e.tasks[u],d=i.requiredBy,l=r[u];(!d||l&&l[0]===d.length)&&(i.lateStart=l[1]-i.duration,i.lateFinish=l[1],i.floatAmt=i.lateFinish-i.earlyFinish,i.dependsOn&&o(e,r,i.dependsOn,i.lateStart))}}function c(e,r,n,t){for(var a=t?function(e,r){return r>e}:function(e,r){return e>r},s=0,u=r.length;u>s;s++){var i=r[s];e[i]?(e[i][0]=e[i][0]+1,e[i][1]=a(n,e[i][1])?n:e[i][1]):e[i]=[1,n]}}return r(e)},c.resourceManager=function(e,r){function n(e,r){var n,a,s={};if(e)for(n=0,a=e.length;a>n;n++)t(s,e[n],r);return s}function t(e,r,n){var t=JSON.parse(JSON.stringify(r.schedule||v)),a=c.memoizedRangeFn(d.schedule(t).nextRange);e[r.id]={schedule:t,next:a,nextAvail:a(n)}}function a(e,r,n,t){var a,i=[],c={};for(maxTries=50,f(e,r,i,c);!(a=s(i,n,t)).success&&--maxTries;)u(i,o(i),c),a.delays=c;return a}function s(e,r,n){for(var t,a,s={success:!1},u=[],i=0,o=e.length;o>i;i++){var c=e[i],l=c.range;if(!l)return{success:!1};"_"!==c.id[0]&&u.push(c.id),t=!t||l[0]>t?l[0]:t,a=!a||l[1]<a?l[1]:a}var f=(a-t)/d.MIN;return f>=r&&(f=n&&f>n?n:f,a=t+f*d.MIN,s={resources:u,start:t,end:a,duration:f,success:!0},h(u,t,a)),s}function u(e,r,n){for(var t=0,a=e.length;a>t;t++){var s=e[t];s.range[1]<=r&&(s.subRanges?(u(s.subRanges,r,{}),i(s)):(s.range=g[s.id].next(r),"_proj"===s.id||n[s.id]||(n[s.id]={needed:new Date(r),available:new Date(s.range[0])})))}}function i(e){for(var r,n,t=0,a=e.subRanges.length;a>t;t++){var s=e.subRanges[t];(!r||s.range[0]<n[0])&&(r=s.id,n=s.range)}e.id=r,e.range=n}function o(e){for(var r,n=0,t=e.length;t>n;n++){var a=e[n].range[1];r=!r||r>a?a:r}return r}function l(e){var r,n;for(var t in e){var a=e[t].available;(!r||r>a)&&(r=a,n=t)}return n}function f(e,r,n,t){for(var a=0,s=e.length;s>a;a++){var u=e[a];if(Array.isArray(u)){var o=[],c={};f(u,r,o,c);var d=l(c);t[d]=c[d];var h={subRanges:o};i(h),n.push(h)}else{var v=g[u],p=v.nextAvail[0]>=r?v.nextAvail:v.next(r);p[0]>r&&"_proj"!==u&&(t[u]={needed:new Date(r),available:new Date(p[0])}),n.push({id:u,range:p})}}}function h(e,r,n){for(var t=0,a=e.length;a>t;t++){var s=g[e[t]];s.isNotReservable||(r===s.nextAvail[0]?s.nextAvail=s.next(n):(s.schedule.exceptions||(s.schedule.exceptions=[]),s.schedule.exceptions.push({fd_a:[r],fd_b:[n]}),s.next=c.memoizedRangeFn(d.schedule(s.schedule).nextRange),s.nextAvail=s.next(s.nextAvail[0])))}}var v={schedules:[{fd_a:[r.getTime()]}]},g=n(e,r);return{resourceMap:function(){return g},setResource:function(e,r){t(g,e,r)},makeReservation:function(e,r,n,t){return r=r?new Date(r):new Date,a(e,r.getTime(),n||1,t)},moveStartDate:function(e){for(var r in g){var n=g[r];if(n.schedule.exceptions){for(var t=n.schedule.exceptions,a=[],s=0,u=t.length;u>s;s++)(!t[s].fd_b||t[s].fd_b>e)&&a.push(t[s]);n.schedule.exceptions=a,n.next=c.memoizedRangeFn(d.schedule(n.schedule).nextRange)}n.nextAvail[0]<e&&(n.nextAvail=n.next(e))}}}},c.schedule=function(e,r,n,t){function a(){var r,a,i,o=[];for(a=0,i=h.resources.length;i>a;a++){var c=h.resources[a];v.resourceMap()[c]||v.setResource({id:c},t)}for(v.setResource({id:"_proj",schedule:n},t),a=0,i=e.length;i>a;a++){var d=e[a];v.setResource({id:"_task"+d.id,schedule:d.schedule},t)}return u(h.roots),r=s(e,o),f(h.leaves,r[1]),{scheduledTasks:g,failedTasks:o.length?o:null,success:0===o.length,start:r[0],end:r[1]}}function s(e,r){for(var n,t,a=0,s=e.length;s>a;a++){var u=g[e[a].id];u?(n=!n||u.earlyStart<n?u.earlyStart:n,t=!t||u.earlyFinish>t?u.earlyFinish:t):r.push(e[a].id)}return[n,t]}function u(e){for(var r=e.slice(0),n={};r.length;){c.sort.tasks(h,r);var a=h.tasks[r.pop()],s=n[a.id]?n[a.id][1]:t.getTime(),u=l(a,s);u&&a.requiredBy&&(o(r,n,a.requiredBy,u),v.moveStartDate(i(n)))}}function i(e){var r;for(var n in e)(!r||r>e[n][1])&&(r=e[n][1]);return r}function o(e,r,n,t){for(var a=0,s=n.length;s>a;a++){var u=n[a],i=h.tasks[u].dependsOn,o=r[u]||(r[u]=[0,0]);o[0]+=1,o[1]=t>o[1]?t:o[1],(!i||o[0]>=i.length)&&e.push(u)}}function l(e,r){var n=["_proj","_task"+e.id],t=e.resources?n.concat(e.resources):n;for(duration=e.duration,next=r,scheduledTask={schedule:[],duration:e.duration};duration;){var a=v.makeReservation(t,next,e.minSchedule||1,duration);if(!a.success)return void 0;scheduledTask.earlyStart=scheduledTask.earlyStart||a.start,scheduledTask.schedule.push(a),duration-=a.duration,next=a.end}return scheduledTask.earlyFinish=next,g[e.id]=scheduledTask,next}function f(e,r){for(var n=0,t=e.length;t>n;n++){var a=g[e[n]],s=h.tasks[e[n]].dependsOn;a.lateFinish=r,a.floatAmt=(a.lateFinish-a.earlyFinish)/d.MIN,s&&f(s,a.earlyStart)}}var h=c.dependencyGraph(e),v=c.resourceManager(r,t),g={};return a()},c}();