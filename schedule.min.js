schedule=function(){function e(e){return e.id}function t(e){return e.schedule}function n(e){return e.id}function r(e){return e.id}function i(e){return e.schedule}function u(e){return e.resources}function a(e){return e.dependsOn}function o(e){return e.splittable}var l={version:"1.0.0"};l.functor=function(e){return"function"==typeof e?e:function(){return e}};var s=require("later");s.fullDate=s.fd={name:"full date",range:1,val:function(e){return e.fd||(e.fd=e.getTime())},isValid:function(e,t){return s.fd.val(e)===t},extent:function(){return[0,3250368e7]},start:function(e){return e},end:function(e){return e},next:function(e,t){return s.fd.val(e)<t?new Date(t):void 0},prev:function(e,t){return s.fd.val(e)>t?new Date(t):void 0}};var s=require("later");s.date.localTime(),l.tree=function(e){function t(e,t){for(var n,r=0,i=t.length;i>r;r++){var u=e[t[r]];(!n||u.optimial.earlyFinish>n)&&(n=u.optimal.earlyFinish)}return n}function n(e,t,i,u){for(var a=0,o=t.length;o>a;a++){var l=e[t[a]],s=r(l,i,u);s&&l.requiredBy&&n(e,l.requiredBy,i,s)}}function r(e,t,n){if((e.dependencyStarts||(e.dependencyStarts=[])).push(n),e.dependsOn&&e.dependsOn.length>e.dependencyStarts.length)return void 0;n=o(e.dependencyStarts),n=n[0].getTime()===n[1].getTime()?t(n[0]):n,e.optimal.earlyStart=n[0];for(var r=(n[1].getTime()-n[0].getTime())/s.MIN,i=e.duration;i>r;)e.isSplittable&&(i-=r),n=t(n[1]),r=(n[1].getTime()-n[0].getTime())/s.MIN;return e.optimal.earlyFinish=new Date(n[0].getTime()+i*s.MIN),[e.optimal.earlyFinish,n[1]]}function i(e,t,n,r,a){for(var o=0,l=t.length;l>o;o++){var s=e[t[o]],d=u(s,n,r);(!s.maxDepth||s.maxDepth<a)&&(s.maxDepth=a||0,p=a>p?a:p),d&&s.dependsOn&&i(e,s.dependsOn,n,d,(a||0)+1)}}function u(e,t,n){if((e.requiredByEnds||(e.requiredByEnds=[])).push(n),e.requiredBy&&e.requiredBy.length>e.requiredByEnds.length)return void 0;n=l(e.requiredByEnds),n=n[0].getTime()===n[1].getTime()?t(n[1].getTime()-s.SEC):n,e.optimal.lateFinish=n[1];for(var r=(n[1].getTime()-n[0].getTime())/s.MIN,i=e.duration;i>r;)e.isSplittable&&(i-=r),n=t(n[0].getTime()-s.SEC),r=(n[1].getTime()-n[0].getTime())/s.MIN;return e.optimal.lateStart=new Date(n[1].getTime()-i*s.MIN),e.optimal.floatDays=a(new Date(e.optimal.earlyStart),new Date(e.optimal.lateStart)),[n[0],e.optimal.lateStart]}function a(e,t){return s.D.val(e)===s.D.val(t)?(s.h.val(t)-s.h.val(e))/24:(s.D.start(t).getTime()-s.D.start(e).getTime())/s.DAY}function o(e){for(var t=e[0],n=1,r=e.length;r>n;n++)e[n][0]>t[0]&&(t=e[n]);return t}function l(e){for(var t=e[0],n=1,r=e.length;r>n;n++)e[n][1]<t[1]&&(t=e[n]);return t}function d(e){var t={};return function(n){return t[n]||(t[n]=e.nextRange(1,n))}}function f(e){var t={};return function(n){return t[n]||(t[n]=e.prevRange(1,n))}}function c(e,t,n){for(var r=0,i=t.length;i>r;r++){var u=e[t[r]];if(0===u.optimal.floatDays){n.push(u.id),u.requiredBy&&c(e,u.requiredBy,n);break}}}var h=buildTaskMap(e),g=[],v=[],p=0,m=s.schedule({schedules:[{dw:[2,3,4,5,6],h_a:[8],h_b:[16]}]}),y=(d(m),f(m));findRequiredBy(h),findRootsAndLeaves(h,g,v),n(h,g,nextRange,nextRange(new Date(2013,2,21)));var T=t(h,v);if(i(h,v,y,y(T)),0===g.length)throw new Error("At least one task must not depend on any others.");return{roots:function(){return g},leaves:function(){return v},depth:function(){return p},items:function(){return h},criticalPath:function(){var e=[];return c(h,g,e),e}}},l.resources=function(n){function r(){for(var e={},t=l.functor(i),r=l.functor(u),a=0,o=n.length;o>a;a++){var s=n[a],d=t.call(this,s,a),f=r.call(this,s,a);e[d]={id:d,schedule:f}}return e}var i=e,u=t;return r.id=function(e){return arguments.length?(i=e,r):i},r.schedule=function(e){return arguments.length?(u=e,r):u},r},l.tasks=function(e){function t(){for(var t=[],n=l.functor(s),r=l.functor(d),i=l.functor(f),u=l.functor(c),a=l.functor(h),o=l.functor(g),v=0,p=e.length;p>v;v++){var m=e[v],y={id:n.call(this,m,v),duration:r.call(this,m,v),schedule:i.call(this,m,v),resources:u.call(this,m,v),dependsOn:a.call(this,m,v),splittable:o.call(this,m,v)};t.push(y)}return map}var s=n,d=r,f=i,c=u,h=a,g=o;return t.id=function(e){return arguments.length?(s=e,t):s},t.duration=function(e){return arguments.length?(d=e,t):d},t.schedule=function(e){return arguments.length?(f=e,t):f},t.resources=function(e){return arguments.length?(c=e,t):c},t.dependsOn=function(e){return arguments.length?(h=e,t):h},t.splittable=function(e){return arguments.length?(g=e,t):g},t},l.dependencyGraph=function(e){function t(e){for(var t={tasks:{},roots:[],leaves:[],depth:0,end:0},l=0,s=e.length;s>l;l++)t.tasks[e[l].id]=e[l];return r(t.tasks),i(t),u(t,t.leaves,0),a(t,{},t.roots,0),n(t,t.leaves),o(t,{},t.leaves,t.end),t}function n(e,t){for(var n=0,r=t.length;r>n;n++){var i=e.tasks[t[n]].earlyFinish;e.end=i>e.end?i:e.end}}function r(e){for(var t in e){var n=e[t],r=n.dependsOn;if(r)for(var i=0,u=r.length;u>i;i++){var a=e[r[i]];(a.requiredBy||(a.requiredBy=[])).push(n.id)}}}function i(e){for(var t in e.tasks){var n=e.tasks[t];n.dependsOn&&0!==n.dependsOn.length?n.requiredBy&&0!==n.requiredBy.length||e.leaves.push(n.id):e.roots.push(n.id)}}function u(e,t,n){for(var r=0,i=t.length;i>r;r++){var a=e.tasks[t[r]],o=a.dependsOn;a.depth=!a.depth||n>a.depth?n:a.depth,e.depth=n>e.depth?n:e.depth,o&&u(e,o,a.depth+1)}}function a(e,t,n,r){l(t,n,r);for(var i=0,u=n.length;u>i;i++){var o=n[i],s=e.tasks[o],d=s.dependsOn,f=t[o];(!d||f&&f[0]===d.length)&&(s.earlyStart=f[1],s.earlyFinish=f[1]+s.duration,s.requiredBy&&a(e,t,s.requiredBy,s.earlyFinish))}}function o(e,t,n,r){l(t,n,r,!0);for(var i=0,u=n.length;u>i;i++){var a=n[i],s=e.tasks[a],d=s.requiredBy,f=t[a];(!d||f&&f[0]===d.length)&&(s.lateStart=f[1]-s.duration,s.lateFinish=f[1],s.floatAmt=s.lateFinish-s.earlyFinish,s.dependsOn&&o(e,t,s.dependsOn,s.lateStart))}}function l(e,t,n,r){for(var i=r?function(e,t){return t>e}:function(e,t){return e>t},u=0,a=t.length;a>u;u++){var o=t[u];e[o]?(e[o][0]=e[o][0]+1,e[o][1]=i(n,e[o][1])?n:e[o][1]):e[o]=[1,n]}}return t(e)};var s=require("later");l.resourceManager=function(e){function t(e){for(var t={},n=0,r=e.length;r>n;n++){var i=e[n];t[i.id]={initialSchedule:i.schedule,schedule:l(i.schedule),next:o(s.schedule(i.schedule).nextRange),prev:o(s.schedule(i.schedule).prevRange)}}return t}function n(e,t,n,a){for(var o=[],l=null,d=0,f=t,c=!1;!c&&f&&f.getTime()<t.getTime()+365*s.DAY;){c=!0;for(var h=0,g=e.length;g>h;h++)(!o[h]||o[h][1].getTime()<=f.getTime())&&(o[h]=e[h](f));l=r(o),d=l?i(l):0,n>d&&(f=u(o)[1],l=void 0,c=!1)}return d>a&&(l=[l[0],new Date(l[0].getTime()+a*s.MIN)]),l}function r(e){for(var t,n,r=0,i=e.length;i>r;r++){var u=e[r];if(!u)return void 0;(!t||u[0]>t)&&(t=u[0]),(!n||u[1]<n)&&(n=u[1])}return t&&n>t?[t,n]:void 0}function i(e){return(e[1].getTime()-e[0].getTime())/s.MIN}function u(e){var t;console.log("--------"),console.log(e);for(var n=0,r=e.length;r>n;n++)(!t||e[n][1]<t[1])&&(t=e[n]);return t}function a(e,t){for(var n=0,r=e.length;r>n;n++){var i=d[e[n]];(i.schedule.exceptions||(i.schedule.exceptions=[])).push({fd_a:[t[0].getTime()],fd_b:[t[1].getTime()]}),i.next=o(s.schedule(i.schedule).nextRange),i.prev=o(s.schedule(i.schedule).prevRange)}}function o(e){var t={};return function(n){return t[n]||(t[n]=e(1,n))}}function l(e){return JSON.parse(JSON.stringify(e))}var d=t(e);return{next:function(e,t,r,i,u){for(var o=[t],l=0,s=e.length;s>l;l++)o.push(d[e[l]].next);var f=n(o,r,i,u);return f&&a(e,f),f},prev:function(){},clearReservations:function(){}}};var s=require("later");return l.schedule=function(e,t,n){function r(){a(e.roots,y(n));var t=i(e,e.leaves);return l(e.leaves,T(t)),v}function i(e,t){for(var n=0,r=0,i=t.length;i>r;r++){var u=v[t[r]].earlyFinish;n=u>n?u:n}return n}function u(t){t.sort(function(t,n){return e.tasks[n].floatAmt>e.tasks[t].floatAmt})}function a(t,n){var r=[],i={};for(c(r,i,t,n);r.length;){u(r);var a=e.tasks[r.pop()],l=o(r,a,i);a.requiredBy&&c(r,i,a.requiredBy,l)}}function o(e,t,n){var r=n[t.id][1],i=r[0],u=r[1],a={earlySchedule:[],duration:t.duration};r=i.getTime()===u.getTime()?y(u):r;var o=(u.getTime()-i.getTime())/s.MIN,l=t.duration;for(a.earlyStart=i;l>o;)a.earlySchedule.push(h(i,u,o)),l-=o,r=y(u),i=r[0],u=r[1],o=(u.getTime()-i.getTime())/s.MIN;return a.earlyFinish=new Date(i.getTime()+l*s.MIN),a.earlySchedule.push(h(i,a.earlyFinish,l)),v[t.id]=a,p.push(t.id),[a.earlyFinish,u]}function l(t,n){var r=[],i={};for(c(r,i,t,n,!0);p.length;){var u=e.tasks[p.pop()],a=d(r,u,i);u.dependsOn&&c(r,i,u.dependsOn,a,!0)}}function d(e,t,n){var r=n[t.id][1],i=r[0],u=r[1],a=v[t.id];a.lateSchedule=[],r=i.getTime()===u.getTime()?T(i.getTime()-s.SEC):r,i=r[0],u=r[1];var o=(u.getTime()-i.getTime())/s.MIN,l=t.duration;for(a.lateFinish=u;l>o;)a.lateSchedule.push(h(i,u,o)),l-=o,r=T(i.getTime()-s.SEC),i=r[0],u=r[1],o=(u.getTime()-i.getTime())/s.MIN;return a.lateStart=new Date(u.getTime()-l*s.MIN),a.lateSchedule.push(h(a.lateStart,u,l)),a.floatAmt=f(a.earlyFinish,a.lateFinish),[i,a.lateStart]}function f(e,t){return(t.getTime()-e.getTime())/s.DAY}function c(t,n,r,i,u){for(var a=u?function(e,t){return t>e}:function(e,t){return e>t},o=u?"requiredBy":"dependsOn",l=u?1:0,s=0,d=r.length;d>s;s++){var f=r[s];n[f]?(n[f][0]+=1,n[f][1]=a(i[l],n[f][1][l])?i:n[f][1]):n[f]=[1,i];var c=e.tasks[f],h=c[o]?c[o].length:0;n[f][0]>=h&&t.push(f)}}function h(e,t,n){return{start:e,end:t,duration:n}}function g(e){var t={};return function(n){return t[n]||(t[n]=e(1,n))}}var v={},p=[],m=s.schedule(t),y=g(m.nextRange),T=g(m.prevRange);return r()},l}();