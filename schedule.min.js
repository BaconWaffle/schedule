schedule=function(){function e(e){return e.id}function r(e){return e.schedule}function n(e){return e.isNotReservable||!1}function t(e){return e.id}function a(e){return e.duration}function i(e){return e.schedule}function u(e){return e.resources}function s(e){return e.dependsOn}function o(e){return e.minSchedule}function c(e){return e.priority}var d={version:"0.6.0"},l=!l&&require?require("later"):l;if(!l)throw new Error("Schedule.js requires Later.js.");return Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var r=Object(this),n=r.length>>>0;if(0===n)return-1;var t=0;if(arguments.length>1&&(t=Number(arguments[1]),t!=t?t=0:0!=t&&1/0!=t&&t!=-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=n)return-1;for(var a=t>=0?t:Math.max(n-Math.abs(t),0);n>a;a++)if(a in r&&r[a]===e)return a;return-1}),d.date={},d.date.UTC=function(){l.date.UTC()},d.date.localTime=function(){l.date.localTime()},d.functor=function(e){return"function"==typeof e?e:function(){return e}},d.memoizedRangeFn=function(e){var r={};return function(n){if(!r[n]){var t=e(1,n);r[n]=[t[0]?t[0].getTime():41024448e5,t[1]?t[1].getTime():41024448e5]}return r[n]}},d.sort={},d.sort.tasks=function(e,r){r.sort(function(r,n){var t=e.tasks[r],a=e.tasks[n];return a.priority&&(!t.priority||a.priority>t.priority)?-1:t.priority&&(!a.priority||t.priority>a.priority)?1:e.tasks[n].floatAmt>e.tasks[r].floatAmt})},d.resources=function(){function t(e){for(var r=[],n=d.functor(a),t=d.functor(i),s=d.functor(u),o=0,c=e.length;c>o;o++){var l=e[o],f=n.call(this,l,o),h=t.call(this,l,o),v=s.call(this,l,o);r.push({id:f,schedule:h,isNotReservable:v})}return r}var a=e,i=r,u=n;return t.id=function(e){return arguments.length?(a=e,t):a},t.schedule=function(e){return arguments.length?(i=e,t):i},t.isNotReservable=function(e){return arguments.length?(u=e,t):u},t},d.tasks=function(){function e(e){for(var t=[],a=d.functor(r),i=d.functor(n),u=d.functor(l),s=d.functor(f),o=d.functor(h),c=d.functor(v),p=d.functor(g),y=0,m=e.length;m>y;y++){var x=e[y],k={id:a.call(this,x,y),duration:i.call(this,x,y),schedule:u.call(this,x,y),resources:s.call(this,x,y),dependsOn:o.call(this,x,y),minSchedule:c.call(this,x,y),priority:p.call(this,x,y)};t.push(k)}return t}var r=t,n=a,l=i,f=u,h=s,v=o,g=c;return e.id=function(n){return arguments.length?(r=n,e):r},e.duration=function(r){return arguments.length?(n=r,e):n},e.schedule=function(r){return arguments.length?(l=r,e):l},e.resources=function(r){return arguments.length?(f=r,e):f},e.dependsOn=function(r){return arguments.length?(h=r,e):h},e.minSchedule=function(r){return arguments.length?(v=r,e):v},e.priority=function(r){return arguments.length?(g=r,e):g},e},d.dependencyGraph=function(e){function r(e){for(var r={tasks:{},roots:[],leaves:[],resources:[],depth:0,end:0},c=0,d=e.length;d>c;c++){var l=e[c];r.tasks[l.id]={id:l.id,duration:l.duration,priority:l.priority,schedule:l.schedule,minSchedule:l.minSchedule,dependsOn:l.dependsOn,resources:l.resources}}return n(r),t(r.tasks),a(r),i(r,r.leaves,0),r.depth+=1,u(r,{},r.roots,0),s(r,r.leaves),o(r,{},r.leaves,r.end),r}function n(e){for(var r in e.tasks){var n=e.tasks[r];if(!d(n.resources))for(var t=0,a=n.resources.length;a>t;t++){var i=n.resources[t];-1===e.resources.indexOf(i)&&e.resources.push(i)}}}function t(e){for(var r in e){var n=e[r],t=n.dependsOn;if(!d(t))for(var a=0,i=t.length;i>a;a++){var u=e[t[a]];(u.requiredBy||(u.requiredBy=[])).push(n.id)}}}function a(e){for(var r in e.tasks){var n=e.tasks[r];d(n.dependsOn)&&e.roots.push(n.id),d(n.requiredBy)&&e.leaves.push(n.id)}}function i(e,r,n){for(var t=0,a=r.length;a>t;t++){var u=e.tasks[r[t]],s=u.dependsOn;u.depth=!u.depth||n>u.depth?n:u.depth,e.depth=n>e.depth?n:e.depth,d(s)||i(e,s,u.depth+1)}}function u(e,r,n,t){c(r,n,t);for(var a=0,i=n.length;i>a;a++){var s=n[a],o=e.tasks[s],l=o.dependsOn,f=r[s];!o.earlyFinish&&(d(l)||f&&f[0]===l.length)&&(o.earlyStart=f[1],o.earlyFinish=f[1]+o.duration,d(o.requiredBy)||u(e,r,o.requiredBy,o.earlyFinish))}}function s(e,r){for(var n=0,t=r.length;t>n;n++){var a=e.tasks[r[n]].earlyFinish;e.end=a>e.end?a:e.end}}function o(e,r,n,t){c(r,n,t,!0);for(var a=0,i=n.length;i>a;a++){var u=n[a],s=e.tasks[u],l=s.requiredBy,f=r[u];(d(l)||f&&f[0]===l.length)&&(s.lateStart=f[1]-s.duration,s.lateFinish=f[1],s.floatAmt=s.lateFinish-s.earlyFinish,d(s.dependsOn)||o(e,r,s.dependsOn,s.lateStart))}}function c(e,r,n,t){for(var a=t?function(e,r){return r>e}:function(e,r){return e>r},i=0,u=r.length;u>i;i++){var s=r[i];e[s]?(e[s][0]=e[s][0]+1,e[s][1]=a(n,e[s][1])?n:e[s][1]):e[s]=[1,n]}}function d(e){return!e||0===e.length}return r(e)},d.resourceManager=function(e,r){function n(e,r){var n={};if(e)for(var a=0,i=e.length;i>a;a++)t(n,e[a],r);return n}function t(e,r,n){var t=JSON.parse(JSON.stringify(r.schedule||p)),a=d.memoizedRangeFn(l.schedule(t).nextRange);e[r.id]={schedule:t,next:a,nextAvail:a(n)}}function a(e,r,n,t){var a,s=[],c={};for(maxTries=50,i(e,r,s,c);!(a=u(s,n,t)).success&&--maxTries;)o(s,f(s),c);return a.delays=c,a}function i(e,r,n,t){for(var a=0,u=e.length;u>a;a++){var s=e[a];if(Array.isArray(s)){var o=[],c={};i(s,r,o,c);var d=v(c);d&&(t[d]=c[d]);var l={subRanges:o};h(l),n.push(l)}else{var f=y[s],g=f.nextAvail[0]>=r?f.nextAvail:f.next(r);g[0]>r&&"_proj"!==s&&(t[s]={needed:r,available:g[0]}),n.push({id:s,range:g})}}}function u(e,r,n){for(var t,a,i={success:!1},u=[],o=0,c=e.length;c>o;o++){var d=e[o],f=d.range;g(d)||u.push(d.id),t=!t||f[0]>t?f[0]:t,a=!a||f[1]<a?f[1]:a}var h=(a-t)/l.MIN;return h>=r&&(h=n&&h>n?n:h,i=s(u,t,h)),i}function s(e,r,n){var t=r+n*l.MIN,a={resources:e,start:r,end:t,duration:n,success:!0};return c(e,r,t),a}function o(e,r,n){for(var t=0,a=e.length;a>t;t++){var i=e[t];i.range[1]>r||(i.subRanges?(o(i.subRanges,r,{}),h(i)):(i.range=y[i.id].next(r),"_proj"===i.id||n[i.id]||(n[i.id]={needed:r,available:i.range[0]})))}}function c(e,r,n){for(var t=0,a=e.length;a>t;t++){var i=y[e[t]];i.isNotReservable||(r!==i.nextAvail[0]&&(i.schedule.exceptions||(i.schedule.exceptions=[]),i.schedule.exceptions.push({fd_a:[r],fd_b:[n]}),i.next=d.memoizedRangeFn(l.schedule(i.schedule).nextRange),n=i.nextAvail[0]),i.nextAvail=i.next(n))}}function f(e){for(var r,n=0,t=e.length;t>n;n++){var a=e[n].range[1];r=!r||r>a?a:r}return r}function h(e){for(var r,n,t=0,a=e.subRanges.length;a>t;t++){var i=e.subRanges[t];(!r||i.range[0]<n[0])&&(r=i.id,n=i.range)}e.id=r,e.range=n}function v(e){var r,n;for(var t in e){var a=e[t].available;(!r||r>a)&&(r=a,n=t)}return n}function g(e){return"_"===e.id[0]}var p={schedules:[{fd_a:[r.getTime()]}]},y=n(e,r);return{getResource:function(e){return y[e]},addResource:function(e,r,n){for(var a=0,i=e.length;i>a;a++){var u="object"!=typeof e[a]?{id:r+e[a]}:{id:r+e[a].id,schedule:e[a].schedule,isNotReservable:e[a].isNotReservable};y[u.id]||t(y,u,n)}},makeReservation:function(e,r,n,t){return r=r?new Date(r):new Date,a(e,r.getTime(),n||1,t)},optimize:function(e){for(var r in y){var n=y[r];if(n.schedule.exceptions){var t=n.schedule.exceptions;n.schedule.exceptions=[];for(var a=0,i=t.length;i>a;a++)(!t[a].fd_b||t[a].fd_b>e)&&n.schedule.exceptions.push(t[a]);n.next=d.memoizedRangeFn(l.schedule(n.schedule).nextRange)}n.nextAvail[0]<e&&(n.nextAvail=n.next(e))}}}},d.create=function(e,r,n,t){function a(){var r,a=[];return v.addResource(h.resources,"",t),v.addResource([{id:"_proj",schedule:n}],"",t),v.addResource(e,"_task",t),i(h.roots),r=s(e,a),f(h.leaves,r[1]),{scheduledTasks:g,failedTasks:a.length?a:null,success:0===a.length,start:r[0],end:r[1]}}function i(e){for(var r=e.slice(0),n={},a=0,i=e.length;i>a;a++)n[e[a]]=[0,t.getTime()];for(;r.length;){d.sort.tasks(h,r);var s=h.tasks[r.pop()],l=n[s.id][1],f=u(s,l);f&&s.requiredBy&&(o(r,n,s.requiredBy,f),v.optimize(c(n)))}}function u(e,r){for(var n=["_proj","_task"+e.id],t=e.resources?n.concat(e.resources):n,a=e.duration,i=r,u={schedule:[],duration:e.duration};a;){var s=v.makeReservation(t,i,e.minSchedule||1,a);if(!s.success)return void 0;u.earlyStart=u.earlyStart||s.start,u.schedule.push(s),a-=s.duration,i=s.end}return u.earlyFinish=i,g[e.id]=u,i}function s(e,r){for(var n,t,a=0,i=e.length;i>a;a++){var u=g[e[a].id];u?(n=!n||u.earlyStart<n?u.earlyStart:n,t=!t||u.earlyFinish>t?u.earlyFinish:t):r.push(e[a].id)}return[n,t]}function o(e,r,n,t){for(var a=0,i=n.length;i>a;a++){var u=n[a],s=h.tasks[u].dependsOn,o=r[u]||(r[u]=[0,0]);o[0]+=1,o[1]=t>o[1]?t:o[1],(!s||o[0]>=s.length)&&e.push(u)}}function c(e){var r;for(var n in e)(!r||r>e[n][1])&&(r=e[n][1]);return r}function f(e,r){for(var n=0,t=e.length;t>n;n++){var a=g[e[n]],i=h.tasks[e[n]].dependsOn;a&&(a.lateFinish=r,a.floatAmt=(a.lateFinish-a.earlyFinish)/l.MIN,i&&f(i,a.earlyStart))}}var h=d.dependencyGraph(e),v=d.resourceManager(r,t),g={};return a()},d}();